# Проект с FastAPI, SQLite, MongoDB и клиентом DB на C++

Этот проект состоит из трех компонентов:

1. **Клиент DB (C++/Qt)**: Графический интерфейс для регистрации и аутентификации пользователей.
2. **Сервер SQLite (Python/FastAPI)**: Хранит учетные данные пользователей.
3. **Сервер MongoDB (Python/FastAPI)**: Обрабатывает операции с матрицами и взаимодействует с сервером SQLite.

#### Подробнее про Сервер MongoDB и Сервер SQLite читайте в `readme.md` соответствующей директории

---

## Структура проекта

```bash
.
├── README.md                # Общее описание проекта
├── db_client                # Клиентская часть на C++/Qt
│   └── DB_client
│       ├── CMakeLists.txt
│       ├── *.cpp, *.h, *.ui # Файлы с исходным кодом интерфейса
└── docker_servers           # Серверная часть в Docker контейнерах
    ├── configs              # Конфигурационные файлы для Docker контейнеров
    ├── db_mongo             # Данные MongoDB
    ├── db_sqlite            # База данных SQLite
    │   └── users.db
    ├── docker-compose.yml   # Конфигурация для запуска всех контейнеров
    ├── mongo_app            # Серверная часть для MongoDB
    │   ├── README.md        # Описание MongoDB приложения
    │   ├── *.py, *.sh       # Исходный код и тесты
    └── sqlite_app           # Серверная часть для SQLite
        ├── readme.md        # Описание SQLite приложения
        ├── *.py, *.sh       # Исходный код и тесты
```

---

## Компоненты проекта

### 1. Клиент DB (C++/Qt)

Клиентское приложение предоставляет графический интерфейс для регистрации и входа в систему. Оно взаимодействует с серверами SQLite и MongoDB, чтобы сохранять и извлекать данные пользователей.

- **Основные файлы**:
  - `login_form.*`, `registration_form.*`: Реализация форм регистрации и входа.
  - `mainwindow.*`: Основное окно приложения.
- **Сборка и запуск**:
  - Для сборки используйте CMake. Убедитесь, что все зависимости для Qt установлены.

### 2. Сервер SQLite (Python/FastAPI)

Этот сервер обрабатывает запросы, связанные с регистрацией и аутентификацией пользователей, и хранит учетные данные в базе данных SQLite.

- **Основные файлы**:
  - `main.py`: Реализация сервера FastAPI.
  - `sql_service.py`: Логика работы с базой данных.
- **Запуск**:
  - Используйте Docker для развертывания. См. инструкцию ниже.

### 3. Сервер MongoDB (Python/FastAPI)

Этот сервер отвечает за выполнение операций с матрицами и хранит данные в MongoDB, используя GridFS для хранения файлов.

- **Основные файлы**:
  - `main.py`: Реализация сервера FastAPI.
  - `mongo_service.py`: Логика взаимодействия с MongoDB.
- **Запуск**:
  - Развертывание через Docker. См. инструкцию ниже.

---

## Требования

- **Docker**: Убедитесь, что Docker установлен на вашей системе.
- **CMake**: Для сборки клиентского приложения на C++.
- **Python**: Для разработки и тестирования серверных приложений.

---

## Настройка и запуск

### 1. Сборка клиентского приложения

Перейдите в каталог `db_client/DB_client` и выполните команды для сборки с помощью CMake:

```bash
mkdir build
cd build
cmake ..
make
```

### 2. Развертывание серверов с помощью Docker

Перейдите в каталог `docker_servers` и выполните следующую команду:

```bash
docker-compose up --build
```

Эта команда создаст и запустит контейнеры для MongoDB, сервера SQLite и FastAPI приложения.

### 3. Тестирование

Для тестирования серверов используйте предоставленные скрипты в каталоге `tests`:
Проверьте, что docker Volumes смонтированы верно
Запускайте тесты именно из папки test (запись `bash docker_servers/mongo_app/tests/test.sh` **НЕВЕРНАЯ**)
```bash
cd docker_servers/mongo_app/tests/
bash tests.sh
cd docker_servers/sqlite_app/tests/
bash tests.sh
```

---

## Переменные окружения

Файлы конфигурации для серверов находятся в `docker_servers/configs`. Убедитесь, что переменные окружения корректно настроены:

- `config_sqlite.env`: Настройки для сервера SQLite.
- `config_mongo_db.env`: Настройки для MongoDB.
- `config_mongo_server.env`: Настройки для сервера MongoDB.

---

## API Конечные точки

### Сервер SQLite

- **Регистрация пользователя**: `POST /register`
- **Вход пользователя**: `POST /login`
- **Получение идентификатора пользователя**: `GET /id_request`

### Сервер MongoDB

- **Сохранение матрицы**: `POST /save_matrix`
- **Получение матрицы по идентификатору**: `GET /get_matrix_by_matrix_id/{file_id}`
- **Список всех файлов**: `GET /list_files`

---

## Примечания

- **Docker Network**: Контейнеры подключены к пользовательской сети Docker для обеспечения связи между ними.
- **Тома Docker**: Убедитесь, что указанные в конфигурации пути *существуют* на вашей системе.
- **Тестирование**: Проверьте все API через `curl` или с помощью предоставленных тестов.

---

